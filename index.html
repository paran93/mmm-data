<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MarketingIQ Pro - Advanced MMM</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        :root {
            --bg-dark: #0B1220;
            --card-bg: #1A2234;
            --accent: #3B82F6;
            --success: #10B981;
            --danger: #EF4444;
            --text-main: #F5F7FA;
            --text-muted: #94A3B8;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg-dark);
            color: var(--text-main);
            line-height: 1.6;
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        .hidden { display: none !important; }

        /* Tooltip Styles */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
            margin-left: 5px;
            color: var(--accent);
            font-size: 0.8rem;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #334155;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 100;
            bottom: 125%; 
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.75rem;
            font-weight: normal;
            line-height: 1.2;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* Hero & Layout */
        .hero { padding: 60px 0; text-align: center; border-bottom: 1px solid #2D3748; }
        .hero h1 { font-size: 2.5rem; margin-bottom: 15px; color: var(--accent); }
        .section { padding: 40px 0; border-bottom: 1px solid #2D3748; }
        .card { background: var(--card-bg); border-radius: 12px; padding: 25px; margin-top: 20px; }
        .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        
        input { 
            width: 100%; background: #0F172A; border: 1px solid #334155; 
            padding: 10px; color: white; border-radius: 6px; margin-top: 5px;
        }
        
        .btn {
            padding: 12px 24px; border-radius: 6px; border: none; font-weight: 600;
            cursor: pointer; transition: 0.2s; display: inline-block;
        }
        .btn-primary { background: var(--accent); color: white; }
        .btn-secondary { background: transparent; border: 1px solid var(--accent); color: var(--accent); }

        /* Metrics */
        .metrics-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .metric-card { background: #0F172A; padding: 20px; border-radius: 10px; text-align: center; border: 1px solid #1E293B; }
        .metric-card h4 { color: var(--text-muted); font-size: 0.8rem; }

        .results-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .results-table th, .results-table td { text-align: left; padding: 12px; border-bottom: 1px solid #2D3748; }
        
        .chart-container { height: 350px; margin-top: 20px; }
    </style>
</head>
<body>

    <div class="hero">
        <div class="container">
            <h1>MarketingIQ Pro</h1>
            <p>Bayesian Marketing Mix Modeling. Hover over icons <span class="tooltip">ⓘ<span class="tooltiptext">These icons provide context on the data and metrics.</span></span> to learn more.</p>
            <div style="margin-top: 30px; display: flex; gap: 15px; justify-content: center;">
                <button onclick="scrollToUpload()" class="btn btn-primary">Start Analysis</button>
                <button onclick="generateDemoData()" class="btn btn-secondary">Use Demo Data</button>
            </div>
        </div>
    </div>

    <div id="uploadSection" class="section">
        <div class="container">
            <div class="card" style="text-align: center; border: 2px dashed #334155;">
                <h3>Step 1: Data Input</h3>
                <p style="margin-bottom: 20px; color: var(--text-muted);">Upload a CSV or click "Use Demo Data" above.</p>
                <input type="file" id="fileInput" accept=".csv" style="display: none;">
                <button onclick="document.getElementById('fileInput').click()" class="btn btn-primary">Choose CSV File</button>
            </div>
        </div>
    </div>

    <div id="configSection" class="section hidden">
        <div class="container">
            <h2>Step 2: Configuration 
                <span class="tooltip">ⓘ<span class="tooltiptext">Adjust these to match your specific business unit economics.</span></span>
            </h2>
            <div class="grid-3">
                <div class="card">
                    <h4>Global Unit Economics</h4>
                    <div style="margin-top:15px;">
                        <label>Avg Order Value ($) <span class="tooltip">ⓘ<span class="tooltiptext">Total Revenue divided by Total Orders.</span></span></label>
                        <input type="number" id="aov" value="85">
                    </div>
                    <div style="margin-top:15px;">
                        <label>Gross Margin (%) <span class="tooltip">ⓘ<span class="tooltiptext">Revenue minus Cost of Goods Sold, expressed as a percentage.</span></span></label>
                        <input type="number" id="grossMargin" value="65">
                    </div>
                </div>

                <div class="card">
                    <h4>Adstock & Decay 
                        <span class="tooltip">ⓘ<span class="tooltiptext">How long an ad "lingers" in a customer's mind. High decay (0.7+) means long-term brand impact.</span></span>
                    </h4>
                    <label>Meta Decay: <input type="number" id="metaDecay" value="0.3" step="0.1"></label>
                    <label>CTV Decay: <input type="number" id="ctvDecay" value="0.7" step="0.1"></label>
                </div>

                <div class="card" style="display: flex; align-items: center; justify-content: center;">
                    <button onclick="runAnalysis()" class="btn btn-primary" style="width:100%; height:80px; font-size:1.2rem;">Calculate Returns</button>
                </div>
            </div>
        </div>
    </div>

    <div id="loadingSection" class="section hidden">
        <div class="container" style="text-align: center;">
            <div class="card"><h3>Processing Bayesian Regression...</h3></div>
        </div>
    </div>

    <div id="resultsSection" class="section hidden">
        <div class="container">
            <div class="metrics-grid" id="summaryMetrics"></div>
            
            <div class="grid-3">
                <div class="card" style="grid-column: span 2;">
                    <h3>Marginal Return Curve 
                        <span class="tooltip">ⓘ<span class="tooltiptext">This shows the predicted profit for the NEXT dollar spent in each channel.</span></span>
                    </h3>
                    <div class="chart-container"><canvas id="roiChart"></canvas></div>
                </div>
                <div class="card">
                    <h3>Channel Efficiency</h3>
                    <div id="performanceTable"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let uploadedData = null;
        let myChart = null;

        function scrollToUpload() { document.getElementById('uploadSection').scrollIntoView({ behavior: 'smooth' }); }
        function showSection(id) { document.getElementById(id).classList.remove('hidden'); }
        function hideSection(id) { document.getElementById(id).classList.add('hidden'); }

        document.getElementById('fileInput').addEventListener('change', function(e) {
            Papa.parse(e.target.files[0], {
                header: true, dynamicTyping: true,
                complete: function(results) {
                    uploadedData = results.data.filter(row => row.date);
                    showSection('configSection');
                }
            });
        });

        function generateDemoData() {
            const data = [];
            for(let i=0; i<60; i++) {
                data.push({
                    date: `2024-01-${i+1}`,
                    meta_spend: 1000 + Math.random() * 500,
                    search_spend: 400 + Math.random() * 200,
                    ctv_spend: i > 30 ? 2000 : 0,
                    orders: 50 + Math.random() * 20,
                    revenue: 4000 + Math.random() * 1000
                });
            }
            uploadedData = data;
            showSection('configSection');
            alert("Demo data loaded. Click 'Calculate Returns' to see tooltips in action.");
        }

        function runAnalysis() {
            showSection('loadingSection');
            setTimeout(() => {
                const aov = parseFloat(document.getElementById('aov').value);
                const margin = parseFloat(document.getElementById('grossMargin').value) / 100;
                
                // Mock Analysis Logic
                const results = {
                    Meta: { spend: 45000, mRoi: 1.8, status: 'Scaling' },
                    Search: { spend: 12000, mRoi: 2.4, status: 'Efficient' },
                    CTV: { spend: 8000, mRoi: 0.9, status: 'Saturated' }
                };

                displayResults(results, aov, margin);
                hideSection('loadingSection');
                showSection('resultsSection');
            }, 1000);
        }

        function displayResults(data, aov, margin) {
            const totalSpend = Object.values(data).reduce((a, b) => a + b.spend, 0);
            
            document.getElementById('summaryMetrics').innerHTML = `
                <div class="metric-card">
                    <h4>Total Spend <span class="tooltip">ⓘ<span class="tooltiptext">Total advertising investment over the period.</span></span></h4>
                    <div class="value">$${(totalSpend/1000).toFixed(1)}k</div>
                </div>
                <div class="metric-card">
                    <h4>Blended ROI <span class="tooltip">ⓘ<span class="tooltiptext">Total Gross Profit divided by Total Spend.</span></span></h4>
                    <div class="value">2.1x</div>
                </div>
            `;

            let table = `<table class="results-table"><thead><tr><th>Channel</th><th>mROI <span class="tooltip">ⓘ<span class="tooltiptext">Marginal ROI: The return on the last dollar spent.</span></span></th></tr></thead><tbody>`;
            Object.entries(data).forEach(([name, val]) => {
                table += `<tr><td>${name}</td><td>${val.mRoi}x</td></tr>`;
            });
            document.getElementById('performanceTable').innerHTML = table + "</tbody></table>";

            const ctx = document.getElementById('roiChart').getContext('2d');
            if (myChart) myChart.destroy();
            myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(data),
                    datasets: [{ label: 'Marginal ROI', data: Object.values(data).map(d => d.mRoi), backgroundColor: '#3B82F6' }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });
        }
    </script>
</body>
</html>

